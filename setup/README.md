# Setup


## VM作成
```Powershell
PS C:\Users\nbchk\work\bbf-kubernetes> vagrant.exe up
Bringing machine 'bbf-kubernetes' up with 'virtualbox' provider...
==> bbf-kubernetes: Importing base box 'generic/ubuntu2204'...
==> bbf-kubernetes: Matching MAC address for NAT networking...
==> bbf-kubernetes: Checking if box 'generic/ubuntu2204' version '4.3.12' is up to date...
==> bbf-kubernetes: Setting the name of the VM: bbf-kubernetes_bbf-kubernetes_1714952788117_49065
==> bbf-kubernetes: Clearing any previously set network interfaces...
==> bbf-kubernetes: Preparing network interfaces based on configuration...
    bbf-kubernetes: Adapter 1: nat
    bbf-kubernetes: Adapter 2: hostonly
==> bbf-kubernetes: Forwarding ports...
    bbf-kubernetes: 22 (guest) => 2222 (host) (adapter 1)
==> bbf-kubernetes: Running 'pre-boot' VM customizations...
==> bbf-kubernetes: Booting VM...
==> bbf-kubernetes: Waiting for machine to boot. This may take a few minutes...
    bbf-kubernetes: SSH address: 127.0.0.1:2222
    bbf-kubernetes: SSH username: vagrant
    bbf-kubernetes: SSH auth method: private key
    bbf-kubernetes: Warning: Connection aborted. Retrying...
    bbf-kubernetes: Warning: Connection reset. Retrying...
    bbf-kubernetes: Warning: Connection aborted. Retrying...
    bbf-kubernetes: Warning: Connection reset. Retrying...
    bbf-kubernetes: Warning: Connection reset. Retrying...
    bbf-kubernetes: Warning: Connection aborted. Retrying...
    bbf-kubernetes: Warning: Connection reset. Retrying...
    bbf-kubernetes: Warning: Connection aborted. Retrying...
    bbf-kubernetes: Warning: Connection reset. Retrying...
    bbf-kubernetes: Warning: Connection aborted. Retrying...
    bbf-kubernetes: Warning: Connection reset. Retrying...
    bbf-kubernetes: Warning: Connection aborted. Retrying...
    bbf-kubernetes: Warning: Connection reset. Retrying...
    bbf-kubernetes: Warning: Connection aborted. Retrying...
    bbf-kubernetes: Warning: Connection reset. Retrying...
    bbf-kubernetes: Warning: Connection aborted. Retrying...
    bbf-kubernetes: Warning: Connection reset. Retrying...
    bbf-kubernetes: Warning: Connection aborted. Retrying...
    bbf-kubernetes: Warning: Connection reset. Retrying...
    bbf-kubernetes: Warning: Connection aborted. Retrying...
    bbf-kubernetes: Warning: Connection reset. Retrying...
    bbf-kubernetes: Warning: Connection aborted. Retrying...
    bbf-kubernetes: Warning: Connection reset. Retrying...
    bbf-kubernetes: Warning: Connection aborted. Retrying...
    bbf-kubernetes: Warning: Connection reset. Retrying...
==> bbf-kubernetes: Machine booted and ready!
==> bbf-kubernetes: Checking for guest additions in VM...
    bbf-kubernetes: The guest additions on this VM do not match the installed version of
    bbf-kubernetes: VirtualBox! In most cases this is fine, but in rare cases it can
    bbf-kubernetes: prevent things such as shared folders from working properly. If you see
    bbf-kubernetes: shared folder errors, please make sure the guest additions within the
    bbf-kubernetes: virtual machine match the version of VirtualBox you have installed on
    bbf-kubernetes: your host and reload your VM.
    bbf-kubernetes:
    bbf-kubernetes: Guest Additions Version: 6.1.38
    bbf-kubernetes: VirtualBox Version: 7.0
==> bbf-kubernetes: Setting hostname...
==> bbf-kubernetes: Configuring and enabling network interfaces...
==> bbf-kubernetes: Running provisioner: shell...
    bbf-kubernetes: Running: inline script
    bbf-kubernetes: Hit:1 https://mirrors.edge.kernel.org/ubuntu jammy InRelease
    bbf-kubernetes: Get:2 https://mirrors.edge.kernel.org/ubuntu jammy-updates InRelease [119 kB]
    bbf-kubernetes: Get:3 https://mirrors.edge.kernel.org/ubuntu jammy-backports InRelease [109 kB]
    bbf-kubernetes: Get:4 https://mirrors.edge.kernel.org/ubuntu jammy-security InRelease [110 kB]
    bbf-kubernetes: Get:5 https://mirrors.edge.kernel.org/ubuntu jammy-updates/main amd64 Packages [1,612 kB]
    bbf-kubernetes: Get:6 https://mirrors.edge.kernel.org/ubuntu jammy-updates/main Translation-en [304 kB]
    bbf-kubernetes: Get:7 https://mirrors.edge.kernel.org/ubuntu jammy-updates/restricted amd64 Packages [1,830 kB]
    bbf-kubernetes: Get:8 https://mirrors.edge.kernel.org/ubuntu jammy-updates/restricted Translation-en [311 kB]
    bbf-kubernetes: Get:9 https://mirrors.edge.kernel.org/ubuntu jammy-updates/universe amd64 Packages [1,072 kB]
    bbf-kubernetes: Get:10 https://mirrors.edge.kernel.org/ubuntu jammy-updates/universe Translation-en [245 kB]
    bbf-kubernetes: Get:11 https://mirrors.edge.kernel.org/ubuntu jammy-updates/multiverse amd64 Packages [42.7 kB]
    bbf-kubernetes: Get:12 https://mirrors.edge.kernel.org/ubuntu jammy-updates/multiverse Translation-en [10.4 kB]
    bbf-kubernetes: Get:13 https://mirrors.edge.kernel.org/ubuntu jammy-backports/main amd64 Packages [67.1 kB]
    bbf-kubernetes: Get:14 https://mirrors.edge.kernel.org/ubuntu jammy-backports/main Translation-en [11.0 kB]
    bbf-kubernetes: Get:15 https://mirrors.edge.kernel.org/ubuntu jammy-backports/universe amd64 Packages [27.2 kB]
    bbf-kubernetes: Get:16 https://mirrors.edge.kernel.org/ubuntu jammy-backports/universe Translation-en [16.2 kB]
    bbf-kubernetes: Get:17 https://mirrors.edge.kernel.org/ubuntu jammy-security/main amd64 Packages [1,394 kB]
    bbf-kubernetes: Get:18 https://mirrors.edge.kernel.org/ubuntu jammy-security/main Translation-en [243 kB]
    bbf-kubernetes: Get:19 https://mirrors.edge.kernel.org/ubuntu jammy-security/restricted amd64 Packages [1,773 kB]
    bbf-kubernetes: Get:20 https://mirrors.edge.kernel.org/ubuntu jammy-security/restricted Translation-en [300 kB]
    bbf-kubernetes: Get:21 https://mirrors.edge.kernel.org/ubuntu jammy-security/universe amd64 Packages [848 kB]
    bbf-kubernetes: Get:22 https://mirrors.edge.kernel.org/ubuntu jammy-security/universe Translation-en [163 kB]
    bbf-kubernetes: Get:23 https://mirrors.edge.kernel.org/ubuntu jammy-security/multiverse amd64 Packages [37.2 kB]
    bbf-kubernetes: Get:24 https://mirrors.edge.kernel.org/ubuntu jammy-security/multiverse Translation-en [7,588 B]
    bbf-kubernetes: Fetched 10.7 MB in 18s (577 kB/s)
    bbf-kubernetes: Reading package lists...
    bbf-kubernetes: Reading package lists...
    bbf-kubernetes: Building dependency tree...
    bbf-kubernetes: Reading state information...
    bbf-kubernetes: ca-certificates is already the newest version (20230311ubuntu0.22.04.1).
    bbf-kubernetes: ca-certificates set to manually installed.
    bbf-kubernetes: The following packages will be upgraded:
    bbf-kubernetes:   curl libcurl4
    bbf-kubernetes: 2 upgraded, 0 newly installed, 0 to remove and 108 not upgraded.
    bbf-kubernetes: Need to get 484 kB of archives.
    bbf-kubernetes: After this operation, 0 B of additional disk space will be used.
    bbf-kubernetes: Get:1 https://mirrors.edge.kernel.org/ubuntu jammy-updates/main amd64 curl amd64 7.81.0-1ubuntu1.16 [194 kB]
    bbf-kubernetes: Get:2 https://mirrors.edge.kernel.org/ubuntu jammy-updates/main amd64 libcurl4 amd64 7.81.0-1ubuntu1.16 [290 kB]
    bbf-kubernetes: dpkg-preconfigure: unable to re-open stdin: No such file or directory
    bbf-kubernetes: Fetched 484 kB in 2s (308 kB/s)
(Reading database ... 76324 files and directories currently installed.)
    bbf-kubernetes: Preparing to unpack .../curl_7.81.0-1ubuntu1.16_amd64.deb ...
    bbf-kubernetes: Unpacking curl (7.81.0-1ubuntu1.16) over (7.81.0-1ubuntu1.15) ...
    bbf-kubernetes: Preparing to unpack .../libcurl4_7.81.0-1ubuntu1.16_amd64.deb ...
    bbf-kubernetes: Unpacking libcurl4:amd64 (7.81.0-1ubuntu1.16) over (7.81.0-1ubuntu1.15) ...
    bbf-kubernetes: Setting up libcurl4:amd64 (7.81.0-1ubuntu1.16) ...
    bbf-kubernetes: Setting up curl (7.81.0-1ubuntu1.16) ...
    bbf-kubernetes: Processing triggers for man-db (2.10.2-1) ...
    bbf-kubernetes: Processing triggers for libc-bin (2.35-0ubuntu3.6) ...
    bbf-kubernetes:
    bbf-kubernetes: Running kernel seems to be up-to-date.
    bbf-kubernetes:
    bbf-kubernetes: No services need to be restarted.
    bbf-kubernetes:
    bbf-kubernetes: No containers need to be restarted.
    bbf-kubernetes:
    bbf-kubernetes: No user sessions are running outdated binaries.
    bbf-kubernetes:
    bbf-kubernetes: No VM guests are running outdated hypervisor (qemu) binaries on this host.
    bbf-kubernetes: Get:1 https://download.docker.com/linux/ubuntu jammy InRelease [48.8 kB]
    bbf-kubernetes: Get:2 https://download.docker.com/linux/ubuntu jammy/stable amd64 Packages [31.5 kB]
    bbf-kubernetes: Hit:3 https://mirrors.edge.kernel.org/ubuntu jammy InRelease
    bbf-kubernetes: Get:4 https://mirrors.edge.kernel.org/ubuntu jammy-updates InRelease [119 kB]
    bbf-kubernetes: Hit:5 https://mirrors.edge.kernel.org/ubuntu jammy-backports InRelease
    bbf-kubernetes: Get:6 https://mirrors.edge.kernel.org/ubuntu jammy-security InRelease [110 kB]
    bbf-kubernetes: Fetched 309 kB in 2s (193 kB/s)
    bbf-kubernetes: Reading package lists...
    bbf-kubernetes: Reading package lists...
    bbf-kubernetes: Building dependency tree...
    bbf-kubernetes: Reading state information...
    bbf-kubernetes: The following additional packages will be installed:
    bbf-kubernetes:   docker-ce-rootless-extras libltdl7 libslirp0 pigz slirp4netns
    bbf-kubernetes: Suggested packages:
    bbf-kubernetes:   aufs-tools cgroupfs-mount | cgroup-lite
    bbf-kubernetes: The following NEW packages will be installed:
    bbf-kubernetes:   containerd.io docker-buildx-plugin docker-ce docker-ce-cli
    bbf-kubernetes:   docker-ce-rootless-extras docker-compose-plugin libltdl7 libslirp0 pigz
    bbf-kubernetes:   slirp4netns
    bbf-kubernetes: 0 upgraded, 10 newly installed, 0 to remove and 108 not upgraded.
    bbf-kubernetes: Need to get 121 MB of archives.
    bbf-kubernetes: After this operation, 434 MB of additional disk space will be used.
    bbf-kubernetes: Get:1 https://download.docker.com/linux/ubuntu jammy/stable amd64 containerd.io amd64 1.6.31-1 [29.8 MB]
    bbf-kubernetes: Get:2 https://mirrors.edge.kernel.org/ubuntu jammy/universe amd64 pigz amd64 2.6-1 [63.6 kB]
    bbf-kubernetes: Get:3 https://mirrors.edge.kernel.org/ubuntu jammy/main amd64 libltdl7 amd64 2.4.6-15build2 [39.6 kB]
    bbf-kubernetes: Get:4 https://mirrors.edge.kernel.org/ubuntu jammy/main amd64 libslirp0 amd64 4.6.1-1build1 [61.5 kB]
    bbf-kubernetes: Get:5 https://mirrors.edge.kernel.org/ubuntu jammy/universe amd64 slirp4netns amd64 1.0.1-2 [28.2 kB]
    bbf-kubernetes: Get:6 https://download.docker.com/linux/ubuntu jammy/stable amd64 docker-buildx-plugin amd64 0.14.0-1~ubuntu.22.04~jammy [29.7 MB]
    bbf-kubernetes: Get:7 https://download.docker.com/linux/ubuntu jammy/stable amd64 docker-ce-cli amd64 5:26.1.1-1~ubuntu.22.04~jammy [14.6 MB]
    bbf-kubernetes: Get:8 https://download.docker.com/linux/ubuntu jammy/stable amd64 docker-ce amd64 5:26.1.1-1~ubuntu.22.04~jammy [25.3 MB]
    bbf-kubernetes: Get:9 https://download.docker.com/linux/ubuntu jammy/stable amd64 docker-ce-rootless-extras amd64 5:26.1.1-1~ubuntu.22.04~jammy [9,321 kB]
    bbf-kubernetes: Get:10 https://download.docker.com/linux/ubuntu jammy/stable amd64 docker-compose-plugin amd64 2.27.0-1~ubuntu.22.04~jammy [12.5 MB]
    bbf-kubernetes: dpkg-preconfigure: unable to re-open stdin: No such file or directory
    bbf-kubernetes: Fetched 121 MB in 19s (6,371 kB/s)
    bbf-kubernetes: Selecting previously unselected package pigz.
(Reading database ... 76324 files and directories currently installed.)
    bbf-kubernetes: Preparing to unpack .../0-pigz_2.6-1_amd64.deb ...
    bbf-kubernetes: Unpacking pigz (2.6-1) ...
    bbf-kubernetes: Selecting previously unselected package containerd.io.
    bbf-kubernetes: Preparing to unpack .../1-containerd.io_1.6.31-1_amd64.deb ...
    bbf-kubernetes: Unpacking containerd.io (1.6.31-1) ...
    bbf-kubernetes: Selecting previously unselected package docker-buildx-plugin.
    bbf-kubernetes: Preparing to unpack .../2-docker-buildx-plugin_0.14.0-1~ubuntu.22.04~jammy_amd64.deb ...
    bbf-kubernetes: Unpacking docker-buildx-plugin (0.14.0-1~ubuntu.22.04~jammy) ...
    bbf-kubernetes: Selecting previously unselected package docker-ce-cli.
    bbf-kubernetes: Preparing to unpack .../3-docker-ce-cli_5%3a26.1.1-1~ubuntu.22.04~jammy_amd64.deb ...
    bbf-kubernetes: Unpacking docker-ce-cli (5:26.1.1-1~ubuntu.22.04~jammy) ...
    bbf-kubernetes: Selecting previously unselected package docker-ce.
    bbf-kubernetes: Preparing to unpack .../4-docker-ce_5%3a26.1.1-1~ubuntu.22.04~jammy_amd64.deb ...
    bbf-kubernetes: Unpacking docker-ce (5:26.1.1-1~ubuntu.22.04~jammy) ...
    bbf-kubernetes: Selecting previously unselected package docker-ce-rootless-extras.
    bbf-kubernetes: Preparing to unpack .../5-docker-ce-rootless-extras_5%3a26.1.1-1~ubuntu.22.04~jammy_amd64.deb ...
    bbf-kubernetes: Unpacking docker-ce-rootless-extras (5:26.1.1-1~ubuntu.22.04~jammy) ...
    bbf-kubernetes: Selecting previously unselected package docker-compose-plugin.
    bbf-kubernetes: Preparing to unpack .../6-docker-compose-plugin_2.27.0-1~ubuntu.22.04~jammy_amd64.deb ...
    bbf-kubernetes: Unpacking docker-compose-plugin (2.27.0-1~ubuntu.22.04~jammy) ...
    bbf-kubernetes: Selecting previously unselected package libltdl7:amd64.
    bbf-kubernetes: Preparing to unpack .../7-libltdl7_2.4.6-15build2_amd64.deb ...
    bbf-kubernetes: Unpacking libltdl7:amd64 (2.4.6-15build2) ...
    bbf-kubernetes: Selecting previously unselected package libslirp0:amd64.
    bbf-kubernetes: Preparing to unpack .../8-libslirp0_4.6.1-1build1_amd64.deb ...
    bbf-kubernetes: Unpacking libslirp0:amd64 (4.6.1-1build1) ...
    bbf-kubernetes: Selecting previously unselected package slirp4netns.
    bbf-kubernetes: Preparing to unpack .../9-slirp4netns_1.0.1-2_amd64.deb ...
    bbf-kubernetes: Unpacking slirp4netns (1.0.1-2) ...
    bbf-kubernetes: Setting up docker-buildx-plugin (0.14.0-1~ubuntu.22.04~jammy) ...
    bbf-kubernetes: Setting up containerd.io (1.6.31-1) ...
    bbf-kubernetes: Created symlink /etc/systemd/system/multi-user.target.wants/containerd.service → /lib/systemd/system/containerd.service.
    bbf-kubernetes: Setting up docker-compose-plugin (2.27.0-1~ubuntu.22.04~jammy) ...
    bbf-kubernetes: Setting up libltdl7:amd64 (2.4.6-15build2) ...
    bbf-kubernetes: Setting up docker-ce-cli (5:26.1.1-1~ubuntu.22.04~jammy) ...
    bbf-kubernetes: Setting up libslirp0:amd64 (4.6.1-1build1) ...
    bbf-kubernetes: Setting up pigz (2.6-1) ...
    bbf-kubernetes: Setting up docker-ce-rootless-extras (5:26.1.1-1~ubuntu.22.04~jammy) ...
    bbf-kubernetes: Setting up slirp4netns (1.0.1-2) ...
    bbf-kubernetes: Setting up docker-ce (5:26.1.1-1~ubuntu.22.04~jammy) ...
    bbf-kubernetes: Created symlink /etc/systemd/system/multi-user.target.wants/docker.service → /lib/systemd/system/docker.service.
    bbf-kubernetes: Created symlink /etc/systemd/system/sockets.target.wants/docker.socket → /lib/systemd/system/docker.socket.
    bbf-kubernetes: Processing triggers for man-db (2.10.2-1) ...
    bbf-kubernetes: Processing triggers for libc-bin (2.35-0ubuntu3.6) ...
    bbf-kubernetes:
    bbf-kubernetes: Running kernel seems to be up-to-date.
    bbf-kubernetes:
    bbf-kubernetes: No services need to be restarted.
    bbf-kubernetes:
    bbf-kubernetes: No containers need to be restarted.
    bbf-kubernetes:
    bbf-kubernetes: No user sessions are running outdated binaries.
    bbf-kubernetes:
    bbf-kubernetes: No VM guests are running outdated hypervisor (qemu) binaries on this host.
    bbf-kubernetes:   % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
    bbf-kubernetes:                                  Dload  Upload   Total   Spent    Left  Speed
100    80  100    80    0     0    182      0 --:--:-- --:--:-- --:--:--   182
100    75  100    75    0     0     80      0 --:--:-- --:--:-- --:--:--    80
100 65.7M  100 65.7M    0     0  5642k      0  0:00:11  0:00:11 --:--:-- 6113k

PS C:\Users\nbchk\work\bbf-kubernetes> vagrant.exe status
Current machine states:

bbf-kubernetes            running (virtualbox)

The VM is running. To stop this VM, you can run `vagrant halt` to
shut it down forcefully, or you can run `vagrant suspend` to simply
suspend the virtual machine. In either case, to restart it again,
simply run `vagrant up`.
```


## SSH config修正
- SSH configに以下の内容を追加する
```
Host bbf-kubernetes
  HostName 192.168.3.101
  User vagrant
  UserKnownHostsFile /dev/null
  StrictHostKeyChecking no
  PasswordAuthentication no
  IdentityFile C:/Users/<ユーザ名>/.vagrant.d/insecure_private_key
  IdentitiesOnly yes
  LogLevel FATAL
  ForwardAgent yes
  PubkeyAcceptedKeyTypes +ssh-rsa
  HostKeyAlgorithms +ssh-rsa
```


## VMログイン
```powershell
PS C:\Users\nbchk\work\bbf-kubernetes> ssh bbf-kubernetes
vagrant@bbf-kubernetes:~$
```

## 必要なコマンドのインストール確認
```powershell
❯ goss --gossfile ./setup/tests/goss.yaml validate
...

Total Duration: 0.106s
Count: 3, Failed: 0, Skipped: 0
```
